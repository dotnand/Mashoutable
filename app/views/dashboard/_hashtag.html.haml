- if hashtag.persisted?
  - hashtag_text = hashtag.tag.gsub('#', '').gsub(/[^\w]/, '').downcase
  %div{:id => "mashout-#{hashtag_text}-hashtag-container", :class => 'left'}
    %input{:id => "mashout-#{hashtag_text}-hashtag", :name => "mashout-hashtag[]", :type => "checkbox", :value => hashtag.tag, :checked => (defined?(checked) and checked) ? 'checked' : nil}
    %label{:id => "mashout-#{hashtag_text}-hashtag-label", :for => "mashout-#{hashtag_text}-hashtag"}
      = hashtag.tag
    %input{:id => "mashout-#{hashtag_text}-hashtag-text", :type => 'text', :value => defined?(new_tag) ? new_tag : hashtag.tag, :class => 'left hidden'}
    %a{:id => "mashout-#{hashtag_text}-hashtag-edit", :class => 'left'}
      Edit
    %a{:id => "mashout-#{hashtag_text}-hashtag-confirm", :class => 'left hidden'}
      Confirm
    %a{:id => "mashout-#{hashtag_text}-hashtag-cancel", :class => 'left hidden'}
      Cancel
    - if hashtag.errors.any?
      %p.left.clear
        = hashtag.errors.full_messages.to_sentence
    = link_to 'Delete', user_hashtag_url(hashtag), :id => "mashout-#{hashtag_text}-hashtag-delete", :class => 'left'
    :javascript
      $(function() {
        var hashtagId = "#mashout-#{hashtag_text}-hashtag"
        bindDynamicPreviewCheckboxClick(hashtagId, '#hidden-hashtags', '#out-preview');
        inlineEdit(hashtagId, "#{user_hashtag_url(hashtag)}")
      })
    - if hashtag.errors.any?
      :javascript
        $(function() {
          makeHashtagEditable("#mashout-#{hashtag_text}-hashtag")
        })
    - if defined?(checked) and checked
      :javascript
        $(function() {
          generateOutFragment("#{hashtag.tag}", '#hidden-hashtags', '#out-preview')
          generateDynamicOutPreview('#out-preview')
        })
- else
  #new-mashout-hashtag-container
    %input#new-mashout-hashtag-text.left{:type => 'text', :value => hashtag.tag}
    %a#new-mashout-hashtag-confirm.left
      Confirm
    %a#new-mashout-hashtag-cancel.left
      Cancel
    %p.left
      = hashtag.errors.full_messages.to_sentence
